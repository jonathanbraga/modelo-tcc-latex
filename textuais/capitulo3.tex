\chapter[Desenvolvimento]{Desenvolvimento}
\label{ch:desenvolvimento}
O \textit{Power Monitor} surgiu da necessidade da conscientização do gasto energético e da melhor compreensão da conta de luz. Baseado nesse conceito,
foram desenvolvido um \textit{software} que permitirá uma fácil comunicação com qualquer equipamento construído que tenha a finalidade de monitorar a energia elétrica e um \textit{hardware} para demonstração
da comunicação entre ambos. O sistema traz uma forma mais fácil e próxima do consumidor final de se quantificar a energia elétrica consumida em um estabelecimento. No lugar do Quilowatt-hora, medida que é usada atualmente,
o \textit{software} propõe mensurar o gasto energético em reais (R\$), trazendo a realidade do consumo mensal para mais próximo de cada brasileiro.

Nesse capítulo será mostrado todo o passo a passo para o desenvolvimento do \textit{software} e \textit{hardware}, juntamente com a comunicação 
entre ambos, por fim será mostrado os resultados obtidos. 


\section[\textit{Visão Geral}]{\textit{Visão Geral}}\label{visal-geral}

Em resumo pode-se ter uma visão geral de como o ambiente - \textit{software} e \textit{hardware} - funciona observando a \autoref{fig:diagrama-vg}.
O sistema \textit{web} é responsável por fazer a comunicação entre o banco de dados e os dispositivos, já os eletrodomesticos são gerenciados
pelo ESP8266 que possui uma comunicação direta via \textit{websocket} com o sistema \textit{web}.

\begin{figure}[h!]
	\includegraphics[width=0.7\textwidth, keepaspectratio=true]{diagrama-1}
	\centering
	\caption[Visão geral do ambiente]{Visão geral do ambiente}
	\label{fig:diagrama-vg}
\end{figure}
\FloatBarrier

\section[\textit{Software}]{\textit{Software}}\label{soft-sec}
O controle dos dispositivos de um cômodo, que estão interligados com o \textit{ESP8266} são controlados pelo \textit{software}. Dessa forma
todos os dispositivos que possuem comunicação com o microcontrolador e que estão cadastrados nos sistema podem ser controlados (Ligar/Desligar) e também
é possível ter um acompanhamento dos gastos.

O sistema possui uma interface \textit{web} que pode ser acessada por qualquer dispositivo que tenha acesso a internet e possua um 
\textit{browser}. O \textit{software} possui uma interface de apenas um único usuário, ao acessar o sistema o usuário se depara com um
visual bem agradável e fácil de se usar. Ao entrar no sistema o usuário visualiza a página principal, \autoref{fig:principal-ft}, nela encontram-se
as principais informações que o usuário irá precisar, como também mostrar as oções de cadastrar um novo dispositivo, listar os dispositivos, cadastrar um novo cômodo,
listar um novo cômodo etc.

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{principal}
	\centering
	\caption[Tela inicial do sistema]{Tela inicial do sistema}
	\label{fig:principal-ft}
\end{figure}
\FloatBarrier

Todas as informações colhidas pelo servidor em \textit{node.js} (\autoref{node}), são recebidas e tratadas pelo sistema \textit{web}. Os dados
são importantíssimos, pois mediante eles é que se torna possível a contrução dos gráficos e das previsões fornecidas pelo sistema. No \textit{Power Monitor}
a forma de comunicação com o banco de dados é feita mediante as chamadas de API, existe uma chamada para cada ação prevista no sistema. A \autoref{fig:api-ft}
retrata bem esse cenário, pode-se perceber que o \textit{end-point} (expressão utilizada para se referenciar a um extremidade de um canal de comunicação, portanto, isso 
seria representado como a URL de um servidor ou serviço.) \textbf{get-comodos} é destinado a obtenção de todos os cômodos cadastrados já o \textit{end-point}
\textbf{get-dispositivos} é destinado a obtenção de todos os dispostivos cadastrados. O motivo da comunicação entre servidor \textit{web} e sistema \textit{web}
ser feita via chamada de API é bem simples, pois qualquer sistema seja \textit{web, desktop} ou qualquer outro tipo, basicamente precisa ter uma comunicação com a internet
para utilizar o \textit{Power Monitor}. O \textit{software web} não precisa obrigatoriamente de internet para poder funcionar, pois a comunicação entre servidor e sistema é
baseada em uma rede local, justamente para que o \textit{software} não dependa de terceiros. Para uma perfeita comunicação o ambiente só precisa está configurado
na mesma rede \textit{Wi-Fi}. 

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{api}
	\centering
	\caption[Chamada de API]{Chamada de API}
	\label{fig:api-ft}
\end{figure}
\FloatBarrier

O \textit{software} pode ser dividido em duas partes, servidor \textit{web} e interface \textit{web}. O servidor foi desenvolvido usando a linguagem
\textit{javascript} (\autoref{js}) e para auxílio foi utilizado o \textit{framework node.js} (\autoref{node}), a comunicação entre servidor e banco de dados
é feita pelo \textit{MySQL Server} (\autoref{sql}). A interface \textit{web} é o agente consumidor de todos esses serviços, com uma comunicação via 
\textit{webscoket} (\autoref{websocket}) com o servidor é capaz de receber e enviar dados a qualquer instante. A combinação desses três serviços - servidor \textit{web},
servidor do banco de dados e interface \textit{web} - resultou em uma aplicação intuitiva e amigável, desenvolvida para dar o total suporte às análises do dados
enviados pelo \textit{hardware}. Como já foi apresentada a \autoref{fig:principal-ft} representa a tela inicial da interface \textit{web}, vê-se que é possível
visualizar o total gasto no mês decorrente, o progresso dos gastos por cômodo que por sua vez é baseado na espectativa de gasto mensal (\autoref{fig:configuracao-ft}), a lista
de todos os cômodos cadastrados e um gráfico mostrando o consumo por cômodo referente ao mês atual.

As figuras: \ref{fig:c-comodo}, \ref{fig:l-comodo}, \ref{fig:c-dispositivo}, \ref{fig:l-dispositivo} e \ref{fig:configuracao-ft}, 
são relacionadas as telas de cadastro, listagem e de configuração da interface \textit{web}. Nelas é possível cadastrar e listar comodôs e dispositivos assim como 
configurar alguns parâmetros do sistema como o preço da trarifa cobrado por KWh pela empresa resposável e a espectativa de gasto mensal.

Uma vez que os cômodos, dispositivos e parâmetros são cadastrados no sistema é possível gerencia-los através da edição ou exclusão dos dados, que se torna possível
nas telas de listagem, para os cômodos e dispositivos, já os parâmetros do sistema na própria tela de configuração se faz a edição dos dados. 

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{c-comodo}
	\centering
	\caption[Cadastro de um cômodo]{Cadastro de um cômodo}
	\label{fig:c-comodo}
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{l-comodo}
	\centering
	\caption[Lista dos cômodos cadastrados]{Lista dos cômodos cadastrados}
	\label{fig:l-comodo}
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{c-dispositivo}
	\centering
	\caption[Cadastro de um dispositivo]{Cadastro de um dispositvio}
	\label{fig:c-dispositivo} 
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{l-dispositivo}
	\centering
	\caption[Listagem dos dispositivos cadastrados]{Listagem dos dispositivos cadastrados}
	\label{fig:l-dispositivo} 
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{configuracao}
	\centering
	\caption[Tela de configuração dos parâmetros do sistema]{Tela de configuração dos parâmetros do sistema}
	\label{fig:configuracao-ft} 
\end{figure}
\FloatBarrier

Uma vez que todos os cômodos, dispositivos e parâmetros já se encontram cadastrados e já exista a comunicação establecida com o hardware (***), a interface
\textit{web} disponibiliza um séria de formas para visualização das informações coletadas e tratadas. Na \autoref{fig:extrato} é possível visualizar
uma espécie de extrato do consumo de todos os dispositivos, podendo perceber quando foram ligados, quando foram desligados e assim resultando no total gasto.
Já as figuras: \ref{fig:ano-c}, \ref{fig:matu-c} e \ref{fig:mant-c} referem-se aos gráficos que são contruídos baseados nas informações coletadas pelo sistema.

Os gráficos por sua vez são construídos mediante aos calculos que o sistema faz que usa como base (\autoref{eq-consumo})

\begin{equation} \label{eq-consumo}
	\frac{consumoDoDispositivo \times horasDeUso}{diasDoMês} \times tarifa
\end{equation}

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{extrato}
	\centering
	\caption[Demonstrativo do gasto de cada dispositivo]{Demonstrativo do gasto de cada dispositivo}
	\label{fig:extrato} 
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{ano-c}
	\centering
	\caption[Consumo geral de todos os dispositivos por cômodo ao longo do ano]{Consumo geral de todos os dispositivos por cômodo ao longo do ano}
	\label{fig:ano-c} 
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{matu-c}
	\centering
	\caption[Consumo geral de todos os dispositivos por cômodo ao longo do mês atual]{Consumo geral de todos os dispositivos por cômodo ao longo do mês atual}
	\label{fig:matu-c} 
\end{figure}
\FloatBarrier

\begin{figure}[h!]
	\includegraphics[width=1.0\textwidth, keepaspectratio=true]{mant-c}
	\centering
	\caption[Consumo geral de todos os dispositivos por cômodo ao longo do mês anterior]{Consumo geral de todos os dispositivos por cômodo ao longo do mês anterior}
	\label{fig:mant-c} 
\end{figure}
\FloatBarrier

\section[\textit{Hardware}]{\textit{Hardware}}\label{hard-sec}
\section[\textit{Resultados}]{\textit{Resultados}}\label{resultados-sec}
